<UserControl
    x:Class="ShydControls.Wpf.Aperture.CircularProgressBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ShydControls.Wpf.Aperture"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="RootControl"
    d:DesignHeight="200"
    d:DesignWidth="200"
    mc:Ignorable="d">
    <Grid x:Name="MainGrid" Background="Transparent">
        <!--  背景圆环  -->
        <Ellipse Width="{Binding ElementName=RootControl, Path=RingSize}" Height="{Binding ElementName=RootControl, Path=RingSize}">
            <Ellipse.Stroke>
                <LinearGradientBrush x:Name="RingGradient" StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Offset="0" Color="#66FFFFFF" />
                    <GradientStop Offset="0.5" Color="#CCFFFFFF" />
                    <GradientStop Offset="1" Color="#66FFFFFF" />
                </LinearGradientBrush>
            </Ellipse.Stroke>
            <Ellipse.StrokeThickness>3</Ellipse.StrokeThickness>
            <Ellipse.Effect>
                <DropShadowEffect
                    BlurRadius="25"
                    Opacity="1"
                    ShadowDepth="0"
                    Color="White" />
            </Ellipse.Effect>
            <Ellipse.RenderTransformOrigin>
                <Point X="0.5" Y="0.5" />
            </Ellipse.RenderTransformOrigin>
            <Ellipse.RenderTransform>
                <RotateTransform x:Name="RingRotation" />
            </Ellipse.RenderTransform>
            <Ellipse.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="RingRotation"
                                Storyboard.TargetProperty="Angle"
                                From="0"
                                To="360"
                                Duration="0:0:4" />
                            <!--  呼吸  -->
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetProperty="Effect.BlurRadius"
                                From="15"
                                To="35"
                                Duration="0:0:2" />
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetProperty="Opacity"
                                From="0.3"
                                To="1"
                                Duration="0:0:2" />
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Ellipse.Triggers>
        </Ellipse>
        <Grid>
            <Grid.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <!--  动态调整模糊半径，模拟亮度越高扩散越大  -->
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="StreamBlurEffect"
                                Storyboard.TargetProperty="Radius"
                                From="5"
                                To="15"
                                Duration="0:0:2" />
                            <!--  动态调整发光强度  -->
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="ProgressDropShadowEffect"
                                Storyboard.TargetProperty="Opacity"
                                From="0.5"
                                To="0.8"
                                Duration="0:0:1.5" />
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="ProgressDropShadowEffect"
                                Storyboard.TargetProperty="BlurRadius"
                                From="5"
                                To="20"
                                Duration="0:0:1.5" />
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="ProgressPath"
                                Storyboard.TargetProperty="Opacity"
                                From="0.8"
                                To="0.7"
                                Duration="0:0:2" />
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetName="ProgressPathGradient"
                                Storyboard.TargetProperty="Offset"
                                From="0.2"
                                To="0.8"
                                Duration="0:0:1.8" />
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Grid.Triggers>
            <Path
                x:Name="ProgressPath"
                Width="{Binding ElementName=RootControl, Path=RingSize, Converter={StaticResource SizeConverter}, ConverterParameter=+10}"
                Height="{Binding ElementName=RootControl, Path=RingSize, Converter={StaticResource SizeConverter}, ConverterParameter=+10}"
                RenderTransformOrigin="0.5,0.5"
                StrokeThickness="8">
                <Path.RenderTransform>
                    <TranslateTransform X="2" Y="2" />
                </Path.RenderTransform>
                <Path.Stroke>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Offset="0" Color="#33FFFFFF" />
                        <GradientStop x:Name="ProgressPathGradient" Offset="0.5" Color="#EEFFFFFF" />
                        <GradientStop Offset="1" Color="#33FFFFFF" />
                    </LinearGradientBrush>
                </Path.Stroke>
                <Path.Effect>
                    <DropShadowEffect
                        x:Name="ProgressDropShadowEffect"
                        BlurRadius="10"
                        Opacity="0.7"
                        ShadowDepth="0"
                        Color="White" />
                </Path.Effect>
            </Path>
            <Grid.Effect>
                <BlurEffect
                    x:Name="StreamBlurEffect"
                    Radius="10"
                    RenderingBias="Performance" />
            </Grid.Effect>
        </Grid>
        <Ellipse Width="{Binding ElementName=RootControl, Path=RingSize, Converter={StaticResource SizeConverter}, ConverterParameter=-6}" Height="{Binding ElementName=RootControl, Path=RingSize, Converter={StaticResource SizeConverter}, ConverterParameter=-6}">
            <Ellipse.Fill>
                <RadialGradientBrush Center="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                    <GradientStop Offset="0.8" Color="Transparent" />
                    <GradientStop Offset="1" Color="#66FFFFFF" />
                </RadialGradientBrush>
            </Ellipse.Fill>
            <Ellipse.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                AutoReverse="True"
                                RepeatBehavior="Forever"
                                Storyboard.TargetProperty="Opacity"
                                From="0.3"
                                To="0.6"
                                Duration="0:0:2" />
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Ellipse.Triggers>
        </Ellipse>
    </Grid>
</UserControl>
